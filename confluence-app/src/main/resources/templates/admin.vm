<!DOCTYPE html>
<html>
<head>
    <title>RAG Chatbot Konfiguration</title>
    <meta name="decorator" content="atl.admin">
    <meta name="application-base-url" content="$applicationProperties.getBaseUrl()">
    $webResourceManager.requireResource("com.confluence.rag.confluence-rag-chatbot:confluence-rag-chatbot-resources")
</head>
<body>
    <div class="aui-page-panel">
        <div class="aui-page-panel-inner">
            <section class="aui-page-panel-content">
                <header class="aui-page-header">
                    <div class="aui-page-header-inner">
                        <div class="aui-page-header-main">
                            <h1>RAG Chatbot Konfiguration</h1>
                            <p class="aui-page-header-description">AWS-Integration und Wissensdatenbank-Einstellungen konfigurieren</p>
                        </div>
                    </div>
                </header>

                #if($request.getParameter("saved"))
                    <div class="aui-message aui-message-success">
                        <p class="title">
                            <strong>Erfolg!</strong>
                        </p>
                        <p>Die Konfiguration wurde erfolgreich gespeichert.</p>
                    </div>
                #end

                #if($request.getParameter("error"))
                    <div class="aui-message aui-message-error">
                        <p class="title">
                            <strong>Fehler!</strong>
                        </p>
                        <p>$request.getParameter("error")</p>
                    </div>
                #end

                <div class="aui-group">
                    <div class="aui-item">
                        <!-- Service Status -->
                        <div class="aui-group aui-group-split">
                            <div class="aui-item">
                                <h2>Service-Status</h2>
                                #if($serviceHealthy)
                                    <div class="aui-lozenge aui-lozenge-success">Gesund</div>
                                #else
                                    <div class="aui-lozenge aui-lozenge-error">Fehlerhaft</div>
                                #end
                            </div>
                        </div>

                        <!-- Configuration Form -->
                        <form class="aui" method="post" action="">
                            <div class="field-group">
                                <label for="awsRegion">AWS-Region<span class="aui-icon icon-required">(erforderlich)</span></label>
                                <input class="text" type="text" id="awsRegion" name="awsRegion" value="$!awsRegion" placeholder="us-east-1">
                                <div class="description">AWS-Region, in der Ihre Services bereitgestellt sind</div>
                            </div>

                            <div class="field-group">
                                <label for="awsAccessKey">AWS-Zugriffsschlüssel-ID<span class="aui-icon icon-required">(erforderlich)</span></label>
                                <input class="text" type="text" id="awsAccessKey" name="awsAccessKey" value="$!awsAccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">
                                <div class="description">AWS-Zugriffsschlüssel für API-Zugriff</div>
                            </div>

                            <div class="field-group">
                                <label for="awsSecretKey">AWS Geheimer Zugriffsschlüssel<span class="aui-icon icon-required">(erforderlich)</span></label>
                                <input class="password" type="password" id="awsSecretKey" name="awsSecretKey" placeholder="Geheimen Schlüssel eingeben">
                                <div class="description">AWS geheimer Zugriffsschlüssel (wird verschlüsselt)</div>
                            </div>

                            <div class="field-group">
                                <label for="bedrockModel">Bedrock-Modell</label>
                                <select class="select" id="bedrockModel" name="bedrockModel">
                                    <option value="anthropic.claude-3-sonnet-20240229-v1:0" #if($bedrockModel == "anthropic.claude-3-sonnet-20240229-v1:0")selected#end>Claude 3 Sonnet</option>
                                    <option value="anthropic.claude-3-haiku-20240307-v1:0" #if($bedrockModel == "anthropic.claude-3-haiku-20240307-v1:0")selected#end>Claude 3 Haiku</option>
                                    <option value="amazon.titan-text-express-v1" #if($bedrockModel == "amazon.titan-text-express-v1")selected#end>Titan Text Express</option>
                                </select>
                                <div class="description">KI-Modell zur Antwortgenerierung</div>
                            </div>

                            <div class="field-group">
                                <label for="opensearchEndpoint">OpenSearch-Endpunkt</label>
                                <input class="text long-field" type="url" id="opensearchEndpoint" name="opensearchEndpoint" value="$!opensearchEndpoint" placeholder="https://your-domain.region.es.amazonaws.com">
                                <div class="description">OpenSearch Serverless-Endpunkt für Vektorspeicherung</div>
                            </div>

                            <div class="field-group">
                                <label for="s3Bucket">S3-Bucket</label>
                                <input class="text" type="text" id="s3Bucket" name="s3Bucket" value="$!s3Bucket" placeholder="confluence-rag-documents">
                                <div class="description">S3-Bucket für Dokumentenspeicherung</div>
                            </div>

                            <div class="field-group">
                                <label for="apiGatewayUrl">API Gateway URL</label>
                                <input class="text long-field" type="url" id="apiGatewayUrl" name="apiGatewayUrl" value="$!apiGatewayUrl" placeholder="https://api-id.execute-api.region.amazonaws.com/prod">
                                <div class="description">API Gateway-Endpunkt für Lambda-Funktionen</div>
                            </div>

                            <div class="buttons-container">
                                <div class="buttons">
                                    <input class="button submit" type="submit" value="Konfiguration speichern" id="save-button">
                                    <a class="cancel" href="">Abbrechen</a>
                                </div>
                            </div>
                        </form>

                        <!-- Knowledge Base Management -->
                        <h2>Wissensdatenbank-Quellen</h2>
                        <div class="aui-tabs horizontal-tabs" id="knowledge-sources-tabs">
                            <ul class="tabs-menu">
                                <li class="menu-item active-tab">
                                    <a href="#confluence-sites">Confluence-Websites</a>
                                </li>
                                <li class="menu-item">
                                    <a href="#pdf-documents">PDF-Dokumente</a>
                                </li>
                                <li class="menu-item">
                                    <a href="#external-websites">Externe Websites</a>
                                </li>
                            </ul>
                            
                            <div class="tabs-pane active-pane" id="confluence-sites">
                                <p>Konfigurieren Sie zusätzliche Confluence-Instanzen, um Inhalte zu synchronisieren.</p>
                                <button class="aui-button aui-button-primary" id="add-confluence-source">Confluence-Website hinzufügen</button>
                            </div>
                            
                            <div class="tabs-pane" id="pdf-documents">
                                <p>Laden Sie PDF-Dokumente hoch, die in die Wissensdatenbank aufgenommen werden sollen.</p>
                                <button class="aui-button aui-button-primary" id="upload-pdf">PDF hochladen</button>
                            </div>
                            
                            <div class="tabs-pane" id="external-websites">
                                <p>Fügen Sie externe Websites hinzu, die durchsucht und indexiert werden sollen.</p>
                                <button class="aui-button aui-button-primary" id="add-website">Website hinzufügen</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>
</html>
